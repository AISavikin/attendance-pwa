<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìä –û—Ç–º–µ—Ç–∫–∞ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- PWA Meta Tags -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#3b82f6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    
    <style>
        .student-card {
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .student-card:active {
            transform: scale(0.98);
        }
        .present-true {
            background-color: #dcfce7;
            border-color: #22c55e;
        }
        .present-false {
            background-color: #fee2e2;
            border-color: #ef4444;
        }
        .present-null {
            background-color: #f3f4f6;
            border-color: #d1d5db;
        }
        
        /* –°—Ç–∏–ª—å –¥–ª—è –∫–Ω–æ–ø–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ PWA */
        #installButton {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 50px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            z-index: 1000;
            display: none;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header with Group and Date Selectors -->
    <div class="bg-white shadow-sm border-b sticky top-0 z-10">
        <div class="max-w-md mx-auto px-4 py-4">
            <!-- Date Selector -->
            <div class="mb-3">
                <label class="block text-sm font-medium text-gray-700 mb-1">üìÖ –î–∞—Ç–∞</label>
                <input type="date" id="date-selector" 
                       class="w-full p-2 border border-gray-300 rounded-lg bg-white"
                       onchange="updateAttendanceList()">
            </div>

            <!-- Group Selector -->
            <div class="mb-2">
                <label class="block text-sm font-medium text-gray-700 mb-1">üë• –ì—Ä—É–ø–ø–∞</label>
                <select id="group-selector" 
                        class="w-full p-2 border border-gray-300 rounded-lg bg-white"
                        onchange="updateAttendanceList()">
                    <option value="group1">–ì—Ä—É–ø–ø–∞ 1</option>
                    <option value="group2">–ì—Ä—É–ø–ø–∞ 2</option>
                    <option value="group3">–ì—Ä—É–ø–ø–∞ 3</option>
                </select>
            </div>
        </div>
    </div>

    <!-- Attendance Content -->
    <div id="attendance-content" class="max-w-md mx-auto pb-8">
        <!-- Students list will be loaded here -->
        <div class="px-4 py-3">
            <div class="space-y-2" id="students-container">
                <!-- Students will be dynamically inserted here -->
            </div>
        </div>
    </div>

    <!-- PWA Install Button -->
    <button id="installButton" aria-label="Install app">üì≤ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>

    <script>
        // Mock data - –≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –±—É–¥–µ—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å —Å —Å–µ—Ä–≤–µ—Ä–∞
        const studentsData = {
            'group1': [
                { id: 1, name: '–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω', present: null },
                { id: 2, name: '–ü–µ—Ç—Ä–æ–≤–∞ –ú–∞—Ä–∏—è', present: null },
                { id: 3, name: '–°–∏–¥–æ—Ä–æ–≤ –ê–ª–µ–∫—Å–µ–π', present: null }
            ],
            'group2': [
                { id: 4, name: '–ö–æ–∑–ª–æ–≤–∞ –ê–Ω–Ω–∞', present: null },
                { id: 5, name: '–ù–∏–∫–æ–ª–∞–µ–≤ –î–º–∏—Ç—Ä–∏–π', present: null },
                { id: 6, name: '–§–µ–¥–æ—Ä–æ–≤–∞ –ï–ª–µ–Ω–∞', present: null }
            ],
            'group3': [
                { id: 7, name: '–í–∞—Å–∏–ª—å–µ–≤ –ü–∞–≤–µ–ª', present: null },
                { id: 8, name: '–ú–∏—Ö–∞–π–ª–æ–≤–∞ –û–ª—å–≥–∞', present: null },
                { id: 9, name: '–ê–ª–µ–∫—Å–µ–µ–≤ –°–µ—Ä–≥–µ–π', present: null }
            ]
        };

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
        function updateAttendanceList() {
            const group = document.getElementById('group-selector').value;
            const students = studentsData[group] || [];
            
            const container = document.getElementById('students-container');
            container.innerHTML = '';
            
            students.forEach(student => {
                const studentCard = document.createElement('div');
                studentCard.className = `student-card border-2 rounded-lg p-3 present-${student.present}`;
                studentCard.onclick = () => toggleAttendance(student.id, studentCard);
                
                studentCard.innerHTML = `
                    <div class="flex justify-between items-center">
                        <span class="font-medium text-gray-800">${student.name}</span>
                        <div class="flex items-center">
                            <span class="text-2xl mr-2 student-status">
                                ${student.present === true ? '‚úÖ' : student.present === false ? '‚ùå' : '‚¨ú'}
                            </span>
                        </div>
                    </div>
                `;
                
                container.appendChild(studentCard);
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏
        function toggleAttendance(studentId, element) {
            const group = document.getElementById('group-selector').value;
            const students = studentsData[group];
            const student = students.find(s => s.id === studentId);
            
            // –¶–∏–∫–ª–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ: null -> true -> false -> null
            if (student.present === null) {
                student.present = true;
            } else if (student.present === true) {
                student.present = false;
            } else {
                student.present = null;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤–Ω–µ—à–Ω–∏–π –≤–∏–¥ –∫–∞—Ä—Ç–æ—á–∫–∏
            element.classList.remove('present-true', 'present-false', 'present-null');
            element.classList.add('present-' + student.present);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∫–æ–Ω–∫—É
            const icon = element.querySelector('.student-status');
            icon.textContent = student.present === true ? '‚úÖ' : student.present === false ? '‚ùå' : '‚¨ú';
            
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª –±—ã fetch –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            console.log('Attendance updated:', { studentId, present: student.present });
            
            // –í–∏–±—Ä–æ–æ—Ç–∫–ª–∏–∫ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
            if ('vibrate' in navigator) {
                navigator.vibrate(10);
            }
        }

        // PWA Installation
        let deferredPrompt;
        const installButton = document.getElementById('installButton');

        window.addEventListener('beforeinstallprompt', (e) => {
            // Prevent the mini-infobar from appearing on mobile
            e.preventDefault();
            // Stash the event so it can be triggered later
            deferredPrompt = e;
            // Show the install button
            installButton.style.display = 'block';
        });

        installButton.addEventListener('click', async () => {
            if (!deferredPrompt) return;
            
            // Show the install prompt
            deferredPrompt.prompt();
            // Wait for the user to respond to the prompt
            const { outcome } = await deferredPrompt.userChoice;
            console.log(`User response to the install prompt: ${outcome}`);
            // We no longer need the prompt
            deferredPrompt = null;
            // Hide the install button
            installButton.style.display = 'none';
        });

        window.addEventListener('appinstalled', () => {
            // Hide the install button
            installButton.style.display = 'none';
            // Clear the deferredPrompt variable
            deferredPrompt = null;
            console.log('PWA was installed');
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            const dateSelector = document.getElementById('date-selector');
            const today = new Date().toISOString().split('T')[0];
            dateSelector.value = today;
            
            updateAttendanceList();
        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Service Worker
        if ('serviceWorker' in navigator) {
          navigator.serviceWorker.register('./sw.js')
            .then(registration => {
              console.log('SW registered: ', registration);
            })
            .catch(registrationError => {
              console.log('SW registration failed: ', registrationError);
            });
        }
        });
    </script>
</body>
</html>